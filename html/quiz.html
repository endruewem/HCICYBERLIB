<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBERLIB - Quiz</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/quizpage.css">
    <link rel="stylesheet" href="/css/quiz.css">
</head>
<body>

<!-- ===== HEADER (SAMA) ===== -->
<header>
        <a href="/html/mainpage.html" class="logo-link">
        <div class="logo-container">
            <div class="logo-icon">C</div> 
            <div class="logo-text">CYBERLIB</div>
        </div>
    </a>

    <nav>
        <ul>
            <li><a href="/html/artic.html">Article</a></li>
            <li><a href="/html/quizpage.html" class="active">Quiz</a></li>
            <li><a href="/html/forumpage.html">Forum</a></li>
        </ul>
    </nav>

    <a href="/html/profile.html" class="profile-link">
    <div class="profile-icon"></div>
</a>

</header>

<!-- ===== QUIZ SECTION ===== -->
<section class="hero quiz-page">
    <div class="content-container quiz-run">

        <h1 class="page-title" id="quiz-title">Quiz</h1>

        <div id="quiz-box" class="quiz-box">
            <h2 id="question-text"></h2>
            <div id="options-container"></div>
        </div>

        <div id="result-box" class="result-box" style="display:none;">
            <h2>Result</h2>
            <p id="result-text"></p>
            <a href="/html/quizpage.html" class="back-btn">‚Üê Back to Quiz</a>
        </div>

    </div>
</section>

<!-- ===== FOOTER (SAMA) ===== -->
<footer>
    <div class="footer-logo">CYBERLIB</div>
</footer>

<script>
const params = new URLSearchParams(window.location.search);
const quizId = parseInt(params.get("id"));

let quizData = [];
let index = 0;
let score = 0;

fetch("/data/quizdata.json")
    .then(res => res.json())
    .then(data => {
        const quiz = data.find(q => q.id === quizId);
        if (!quiz) return;

        quizData = quiz.questions;
        document.getElementById("quiz-title").textContent = quiz.title;
        loadQuestion();
    });

function loadQuestion() {
    const q = quizData[index];
    document.getElementById("question-text").textContent = q.q;

    const opt = document.getElementById("options-container");
    opt.innerHTML = "";

    q.options.forEach((o, i) => {
        const btn = document.createElement("button");
        btn.textContent = o;
        btn.className = "option-btn";
        btn.onclick = () => selectAnswer(i);
        opt.appendChild(btn);
    });
}

function selectAnswer(selected) {
    const buttons = document.querySelectorAll(".option-btn");
    const correct = quizData[index].answer;

    buttons.forEach((btn, i) => {
        btn.disabled = true;

        if (i === correct) {
            btn.classList.add("correct");
        }

        if (i === selected && i !== correct) {
            btn.classList.add("wrong");
        }
    });

    if (selected === correct) score++;

    setTimeout(() => {
        index++;
        if (index < quizData.length) {
            loadQuestion();
        } else {
            showResult();
        }
    }, 1000); // delay 1 detik
}


function showResult() {
    document.getElementById("quiz-box").style.display = "none";
    document.getElementById("result-box").style.display = "block";

    document.getElementById("result-text").textContent =
        `You scored ${score} / ${quizData.length}`;

    // SIMPAN STATUS
    sessionStorage.setItem(
        `quiz_${quizId}`,
        JSON.stringify({
            score: score,
            total: quizData.length
        })
    );
}

</script>
<script>
const savedPhoto = sessionStorage.getItem("profilePhoto");
const navbarIcon = document.querySelector(".profile-icon");

if (savedPhoto && navbarIcon) {
    navbarIcon.style.backgroundImage = `url(${savedPhoto})`;
}
</script>

</body>
</html>
